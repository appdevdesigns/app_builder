/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{388:function(ia,ca,f){f.r(ca);var ba=f(1),y=f(12),ha=f(2);ia=f(45);var ea=f(27),da=f(11);f=function(){function f(){this.init()}f.prototype.init=function(){this.I1=!1;this.df=this.rk=this.connection=null;this.Eq={};this.ea=this.RC=null};f.prototype.bga=function(f){for(var w=this,h=0;h<f.length;++h){var r=f[h];switch(r.at){case "create":this.Eq[r.author]||(this.Eq[r.author]=r.aName);this.L8(r);break;case "modify":this.ea.Jm(r.xfdf).then(function(e){w.ea.Cb(e[0])});
break;case "delete":this.ea.Jm("<delete><id>"+r.aId+"</id></delete>")}}};f.prototype.L8=function(f){var w=this;this.ea.Jm(f.xfdf).then(function(h){h=h[0];h.authorId=f.author;w.ea.Cb(h);w.ea.trigger(y.a.UPDATE_ANNOTATION_PERMISSION,[h])})};f.prototype.m8=function(f,w,h){this.rk&&this.rk(f,w,h)};f.prototype.preloadAnnotations=function(f){this.addEventListener("webViewerServerAnnotationsEnabled",this.m8.bind(this,f,"add",{imported:!1}),{once:!0})};f.prototype.initiateCollaboration=function(x,w,h){var r=
this;if(x){r.df=w;r.ea=h.ua();h.addEventListener(y.c.DOCUMENT_UNLOADED,function(){r.disableCollaboration()});r.Aga(x);var e=new XMLHttpRequest;e.addEventListener("load",function(){if(200===e.status&&0<e.responseText.length)try{var h=JSON.parse(e.responseText);r.connection=exports.kb.bha(Object(ea.j)(r.df,"blackbox/"),"annot");r.RC=h.id;r.Eq[h.id]=h.user_name;r.ea.yJ(h.id);r.connection.dK(function(e){e.t&&e.t.startsWith("a_")&&e.data&&r.bga(e.data)},function(){r.connection.send({t:"a_retrieve",dId:x});
r.trigger(f.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[r.Eq[h.id],r.RC])},function(){r.disableCollaboration()})}catch(z){Object(ha.f)(z.message)}});e.open("GET",Object(ea.j)(this.df,"demo/SessionInfo.jsp"));e.withCredentials=!0;e.send();r.I1=!0;r.ea.RU(function(e){return r.Eq[e.Author]||e.Author})}else Object(ha.f)("Document ID required for collaboration")};f.prototype.disableCollaboration=function(){this.rk&&(this.ea.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.rk),this.rk=null);this.connection&&
this.connection.KF();this.ea&&this.ea.yJ("Guest");this.init();this.trigger(f.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};f.prototype.Aga=function(f){var w=this;this.rk&&this.ea.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.rk);this.rk=function(h,r,e){return Object(ba.b)(this,void 0,void 0,function(){var n,x,y,aa,da,ca,ea,ha,ia;return Object(ba.d)(this,function(z){switch(z.label){case 0:if(e.imported)return[2];n={t:"a_"+r,dId:f,annots:[]};return[4,w.ea.xP()];case 1:x=z.ga();"delete"!==
r&&(y=(new DOMParser).parseFromString(x,"text/xml"),aa=new XMLSerializer);for(da=0;da<h.length;da++)ca=h[da],ha=ea=void 0,"add"===r?(ea=y.querySelector('[name="'+ca.Id+'"]'),ha=aa.serializeToString(ea),ia=null,ca.InReplyTo&&(ia=w.ea.sg(ca.InReplyTo).authorId||"default"),n.annots.push({at:"create",aId:ca.Id,author:w.RC,aName:w.Eq[w.RC],parent:ia,xfdf:"<add>"+ha+"</add>"})):"modify"===r?(ea=y.querySelector('[name="'+ca.Id+'"]'),ha=aa.serializeToString(ea),n.annots.push({at:"modify",aId:ca.Id,xfdf:"<modify>"+
ha+"</modify>"})):"delete"===r&&n.annots.push({at:"delete",aId:ca.Id});0<n.annots.length&&w.connection.send(n);return[2]}})})}.bind(w);this.ea.addEventListener(da.a.Events.ANNOTATION_CHANGED,this.rk)};f.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return f}();Object(ia.a)(f);ca["default"]=f}}]);}).call(this || window)
